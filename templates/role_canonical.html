{% extends 'base.html' %}

{% block title %}Your Role — Mafia{% endblock %}

{% block head %}
  <style>
    /* small page-scoped tweaks; primary theme lives in static/css/main.css */
    .role-card{max-width:860px;margin:4vh auto;padding:1.25rem;border-radius:12px}
    .role-badge{font-size:1.25rem;font-weight:700}
    .description{color:var(--muted);margin-top:.5rem}
    .visible-role{padding:.35rem 0;border-bottom:1px solid rgba(0,0,0,0.04)}
    #toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:var(--bg-elev);padding:.6rem 1rem;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.08);opacity:0;transition:opacity .18s}
    #toast.visible{opacity:1}
  </style>
{% endblock %}

{% block content %}
  <div class="role-card card">
    <h1 id="playerName">{{ name | e }}</h1>
    <div class="role-badge" id="roleBadge">{{ role | e }}</div>
    <div id="roleDescription" class="description">{{ description | e }}</div>
    <div id="factionBadge" class="muted small">{{ faction | e }}</div>

    <hr />

    <div id="statusRow">
      <strong id="statusIndicator">—</strong>
      <div class="muted small" id="lastUpdated">&nbsp;</div>
    </div>

    <section id="visibleRoles" style="margin-top:1rem">
      <div class="muted">Loading visible roles…</div>
    </section>

    <section id="votingArea" style="margin-top:1rem"></section>

    <div style="margin-top:1rem;display:flex;gap:.5rem;align-items:center">
      <button id="toggleRole" class="btn btn-ghost">Hide role</button>
      <button id="nightActionBtn" class="btn" data-action-type="mafia_final">Night action</button>
      <a class="btn btn-ghost" href="/">Back</a>
    </div>

    <!-- Suicide prompt card (hidden by default) -->
    <div id="suicideCard" class="card hidden" style="margin-top:1rem">
      <div><strong>Suicide choice</strong></div>
      <div id="suicideChoices" style="margin-top:.5rem"></div>
      <div style="margin-top:.5rem"><button id="suicideClose" class="btn btn-ghost">Close</button></div>
    </div>

  </div>

  <!-- Night action modal -->
  <div id="nightModal" class="card hidden" style="position:fixed;left:50%;top:14%;transform:translateX(-50%);width:90%;max-width:520px;z-index:60">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Choose a target</strong>
      <button id="nightClose" class="btn btn-ghost">Close</button>
    </div>
    <div id="nightTargets" style="margin-top:.75rem"></div>
  </div>

  <div id="toast" role="status" aria-live="polite"></div>

{% endblock %}

{% block scripts %}
  <script>
    // Inject server-side values as safe JSON globals for the role page JS
    window.PLAYER_NAME = {{ name | tojson | safe }};
    window.ROOM_NAME = {{ room_name | tojson | safe }};
    window.PLAYER_ROLE = {{ role | tojson | safe }};
    window.PLAYER_FACTION = {{ faction | tojson | safe }};
    window.ROLE_DESCRIPTION = {{ description | tojson | safe }};
  </script>
  <script src="{{ url_for('static', filename='js/role.js') }}"></script>
{% endblock %}
